
```mermaid
flowchart LR
    %% ====== CLIENT ======
    App["Client App / UI<br>(Web, API, Chatbot)"]

    %% ====== CONTROL PLANE ======
    subgraph CP[Control Plane]
        direction TB

        CP1[bedrock<br>• Models<br>• Fine-tuning<br>• Batch jobs<br>• Provisioned Throughput]
        CP2[bedrock-agent<br>• Agents<br>• Knowledge Bases<br>• Prompts<br>• Flows]
        CP3[bedrock-agentcore-control<br>• Agent Runtimes<br>• Memory<br>• Gateways<br>• Tools]
    end

    %% ====== DATA PLANE ======
    subgraph DP[Data Plane]
        direction TB

        DP1[bedrock-runtime<br>• InvokeModel<br>• Converse<br>• Streaming<br>• Async inference]
        DP2[bedrock-agent-runtime<br>• invoke-agent<br>• retrieve<br>• retrieve-and-generate<br>• invoke-flow]
        DP3[bedrock-agentcore<br>• Agent sessions<br>• Memory I/O<br>• Browser / Code tools]
    end

    %% ====== MODELS ======
    Models["Foundation Models<br>(Claude, Titan, Nova, etc.)"]

    %% ====== FLOWS ======
    App -->|Inference| DP1
    App -->|Agent Chat / RAG| DP2
    App -->|Custom Agent Runtime| DP3

    %% Control → Data relationships
    CP1 -. configures .-> DP1
    CP2 -. deploys .-> DP2
    CP3 -. provisions .-> DP3

    %% Runtime → Models
    DP1 --> Models
    DP2 --> Models
    DP3 --> Models
```

---

## More Detailed View

```mermaid
flowchart LR
    %% ====== CLIENT ======
    App["Client App / UI<br>(Web, API, Chatbot)"]

    AppBackend["App Backend / Orchestration<br>(Auth, routing, state, policies)<br><i>Application-managed</i>"]

    App --> AppBackend

    %% ====== CONTROL PLANE ======
    subgraph CP["Control Plane (Configure & Deploy)"]
        direction TB

        CP1[bedrock<br>• Models<br>• Fine-tuning<br>• Batch jobs<br>• Provisioned Throughput<br><i>Bedrock-managed</i>]

        CP2[bedrock-agent<br>• Agents<br>• Knowledge Bases<br>• Prompts<br>• Flows<br><i>Bedrock-managed</i>]

        CP3[bedrock-agentcore-control<br>• Agent runtimes<br>• Memory strategies<br>• Gateways & tools<br><i>Bedrock-managed</i>]
    end

    %% ====== DATA PLANE ======
    subgraph DP["Data Plane (Runtime Execution)"]
        direction TB

        DP1[bedrock-runtime<br>• InvokeModel / Converse<br>• Streaming / Async<br><i>Stateless inference</i>]

        DP2[bedrock-agent-runtime<br>• invoke-agent<br>• retrieve / RAG<br>• invoke-flow<br><i>Managed agent execution</i>]

        DP3[bedrock-agentcore<br>• Agent sessions<br>• Long & short-term memory I/O<br>• Tool / browser / code exec<br><i>Stateful agent runtime</i>]
    end

    %% ====== MODELS ======
    Models["Foundation Models<br>(Claude, Titan, Nova, etc.)"]

    %% ====== FLOWS ======
    AppBackend -->|"Direct model calls<br>(app-managed prompting)"| DP1
    AppBackend -->|"Agent chat / RAG<br>(Bedrock-managed agents)"| DP2
    AppBackend -->|"Custom agent runtime<br>(state + memory)"| DP3

    %% Control → Data relationships
    CP1 -. configures models & capacity .-> DP1
    CP2 -. deploys agents & flows .-> DP2
    CP3 -. provisions runtimes, memory & tools .-> DP3

    %% Runtime → Models
    DP1 -->|Tokens in / tokens out| Models
    DP2 -->|Agent-planned inference| Models
    DP3 -->|Tool-augmented inference| Models
```

---

```mermaid
sequenceDiagram
    autonumber

    %% =====================================================
    %% Experience Layer
    %% =====================================================
    participant U as User
    participant PP as AI Agent<br><br>(Bedrock Agentic AI Application)<br>Planning and Orchestration Engine

    %% =====================================================
    %% Model Layer
    %% =====================================================
    participant BR as LLM Model<br><br>(Bedrock Claude Opus 4 Model)

    %% =====================================================
    %% Tooling Layer
    %% =====================================================
    participant OA as OpenAPI Tool(s) Schema<br><br>(Bedrock Action Group)
    participant MC as MCP Client<br><br>(Tool Adapter Lambda)
    participant MS as MCP Server<br><br>(PostgreSQL READ Query Tool)

    %% =====================================================
    %% Data Layer
    %% =====================================================
    participant DB as External Tool<br><br>(Amazon PostgreSQL RDS)

    %% -----------------------------------------------------
    %% Tool Discovery (Model-side)
    %% -----------------------------------------------------
    Note over PP,OA: 0) Tool Discovery
    OA ->> PP: OpenAPI Tools Schema sent to Application

    %% =====================================================
    %% 1) Agent Reasoning and Planning
    %% =====================================================
    
    U->>PP: Natural language query

    Note over PP,BR: 1) Agent Reasoning and Planning

    PP->>BR: Prompt + instructions + OpenAPI tool schema
    BR-->>PP: Tool selection decision<br/>(tool name + arguments)

    %% =====================================================
    %% 2) Tool Invocation (Control Plane → Data Plane)
    %% =====================================================
    Note over PP,MC: 2) Tool Invocation<br/>Bedrock Action Group Event

    PP->>MC: Action Group Event<br/>(OpenAPI-based tool + args)

    %% -----------------------------------------------------
    %% Schema Translation Boundary
    %% -----------------------------------------------------
    Note over MC: MCP Client responsibility:<br/>Convert OpenAPI / Action Group event<br/>→ MCP JSON tool schema

    %% =====================================================
    %% 3) MCP Tool Execution
    %% =====================================================
    Note over MC,MS:3) MCP Tool Execution

    MC->>MS: call_tool(tool, MCP_JSON_args)

    %% =====================================================
    %% 4) Data Access
    %% =====================================================
    Note over MS,DB:4) PostgreSQL READ Operation

    MS->>DB: SQL SELECT / READ query
    DB-->>MS: Structured query result

    %% =====================================================
    %% 5) Tool Result Return
    %% =====================================================
    MS-->>MC: MCP tool result (JSON)
    MC-->>PP: Normalized tool response

    %% =====================================================
    %% 6) Final Response Generation
    %% =====================================================
    Note over PP,BR: 6) Final Response Generation

    PP->>BR: Tool result + conversation history
    BR-->>PP: Final response (streamed)

    PP-->>U: Streamed response to user
```